<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwiftUI Data Flow 2023</title>
    
    <link href="/styles/style.css" rel="stylesheet" >


    <link href="/styles/prism.css" rel="stylesheet" >



<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js"></script>
<style>
@media (prefers-color-scheme: dark) {
    :root {
    --pagefind-ui-primary: #eeeeee;
    --pagefind-ui-text: #eeeeee;
    --pagefind-ui-background: #152028;
    --pagefind-ui-border: #152028;
    --pagefind-ui-tag: #152028;
    }
}
</style>
    











  


<meta property="og:site_name" content="TrozWare" >
<meta property="og:title" content="SwiftUI Data Flow 2023 - TrozWare" >
<meta property="og:type" content="website" >
<meta property="og:url" content="https://troz.net/post/2023/swiftui-data-flow-2023/" >
<meta name="keywords" content="Mac app development, Apple Mac, Xcode, Swift, SwiftUI, Apple macOS, books, articles, blog, apps, developer, author, Sarah Reichelt">




  <meta name="description" content="Crazy Mac lady. Mac author &amp; developer. Lover of Apple computers and devices. Swift &amp; SwiftUI enthusiast. Unofficial Mac app dev evangelist" >
  <meta property="og:description" content="Crazy Mac lady. Mac author &amp; developer. Lover of Apple computers and devices. Swift &amp; SwiftUI enthusiast. Unofficial Mac app dev evangelist" >



<link rel="alternate" type="application/rss+xml" href="/index.xml" title="TrozWare">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="TrozWare">
<link rel="alternate" type="application/json" href="/feed.json" title="TrozWare">


<link rel="icon" type="image/png" href="/images/favicon.png">

    <link rel="icon" href="/favicon.ico" sizes="32x32">
<link rel="icon" href="/icon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
</head>

<body>
    <header>
  <nav class="container">
    <div class="nav-brand">
      <a href="/" class="site-title">TrozWare</a>
      <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">
        <span class="hamburger"></span>
      </button>
    </div>

    <ul class="nav-links">
      
        <li>
          <a href="/" class="nav-link">Home</a>
        </li>
      
        <li>
          <a href="/books/" class="nav-link">Books</a>
        </li>
      
        <li>
          <a href="/apps/" class="nav-link">Apps</a>
        </li>
      
        <li>
          <a href="/archives/" class="nav-link">Archives</a>
        </li>
      
        <li>
          <a href="/tags/" class="nav-link">Tags</a>
        </li>
      
        <li>
          <a href="/contact/" class="nav-link">Contact</a>
        </li>
      

      <li>
        <button           class="theme-toggle"
          type="button"
          title="Toggle theme"
          aria-label="Toggle theme"
          onclick="toggleTheme()"
        >
          <svg             xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
            width="1em"
            height="1em"
            class="theme-toggle__dark-side"
            fill="currentColor"
            viewBox="0 0 32 32"
          >
            <path d="M16 .5C7.4.5.5 7.4.5 16S7.4 31.5 16 31.5 31.5 24.6 31.5 16 24.6.5 16 .5zm0 28.1V3.4C23 3.4 28.6 9 28.6 16S23 28.6 16 28.6z" ></path>
          </svg>
        </button>
      </li>
    </ul>
  </nav>
</header>

    
	<main>
        
    <section class="post">
        <h1 data-pagefind-meta="title">SwiftUI Data Flow 2023</h1>

        <p>
            10th July 2023 • 3,251 words • 17 minutes  reading time.
        </p>

        <div class="tag-list">
            
                <a href="/tags/#swift" class="tag-button">#Swift</a>
            
                <a href="/tags/#swiftui" class="tag-button">#SwiftUI</a>
            
        </div>

        <article data-pagefind-body>
            <p>SwiftUI is a reactive framework where the data drives the UI. In 2019, I wrote a <a href="/post/2019/swiftui-data-flow/">post</a> detailing how I manage the various forms of data flow through a SwiftUI app, and with the help of others in the community, I iterated over this until I had a good understanding of the concepts and which methods you should use when. In 2021, I updated the post to cover the minor changes, but there have been no major modifications since then.</p>
<p>At WWDC 2023, things changed a lot! With the introduction of Swift macros, the SwiftUI team was able to reduce the number of property wrappers need to send data around, and remove a lot of boilerplate code.</p>
<p>For this article, I have re-written my sample app as a Mac app and updated it to use the new data macros.</p>
<p>Updated 10th July 2023 to cover changes in version 3 of all the betas.</p>

<h3>Table of Contents</h3>
<ul>
<li>• <a href="#observation">Observation</a></li>
<li>• <a href="#sample-app">Sample app</a></li>
<li>• <a href="#property">Property</a></li>
<li>• <a href="#state">@State</a></li>
<li>• <a href="#binding">@Binding</a></li>
<li>• <a href="#binding-for-a-structure">@Binding for a Structure</a></li>
<li>• <a href="#observable-and-bindable">@Observable and @Bindable</a></li>
<li>• <a href="#observable-and-bindable-list">@Observable and @Bindable List</a></li>
<li>• <a href="#environment">@Environment</a></li>
<li>• <a href="#wrapping-up">Wrapping Up</a></li>
</ul>
<p>With the release of all the version 3 betas, I have added these sections:</p>
<ul>
<li>• <a href="#update-1">Old code still works</a></li>
<li>• <a href="#update-2">Observed properties no longer require initial values</a></li>
<li>• <a href="#update-3"><code>@Environment</code> properties cannot be used for bindings.</a></li>
</ul>
<hr>
<p><a id="observation"></a></p>
<h3>Observation</h3>
<p>In the WWDC talk on <a href="https://developer.apple.com/wwdc23/10149" rel="noreferrer nofollow noopener external" target="_blank">Discover Observation in SwiftUI</a>, Apple showed the following flow chart:</p>
<p><img src="/images/2023/apple_data_flow.jpeg" alt="Apple's flow chart"></p>
<p>This is a good starting point, but I feel that it leaves out a few cases, so I've made my own:</p>
<p><img src="/images/2023/my_data_flow.png" alt="My flow chart"></p>
<p>Apart from adding some details to the decisions points, there are really only two additions to my chart:</p>
<ul>
<li>If a property doesn't need to change, it can be a <code>let</code>.</li>
<li><code>@Bindable</code> only works for classes. The equivalent for structs or primitive data types is still <code>@Binding</code>.</li>
</ul>
<p>The new macros system removes this protocol and property wrappers:</p>
<ul>
<li><code>ObservableObject</code></li>
<li><code>@ObservedObject</code></li>
<li><code>@EnvironmentObject</code></li>
<li><code>@Published</code></li>
</ul>
<p>That's a lot of typing we don't have to do any more!</p>
<p><a id="update-1"></a></p>
<h4>UPDATE 1:</h4>
<p>I didn't make it clear originally, but all these property wrappers still work, and you can still use <code>@Binding</code> for classes, so you can adapt to the new Observation code incrementally. The Apple developer site has a very useful article on <a href="https://developer.apple.com/documentation/swiftui/migrating-from-the-observable-object-protocol-to-the-observable-macro" rel="noreferrer nofollow noopener external" target="_blank">migrating from ObservableObject</a>.</p>
<p><a href="#top">Back to Top</a></p>
<hr>
<p><a id="sample-app"></a></p>
<h3>Sample app</h3>
<p>My sample app demonstrates the following data flow options:</p>
<p><img src="/images/2023/data_flow_types.png" alt="Sample app options"></p>
<p>The code is available on <a href="https://github.com/trozware/swiftui-data-flow-2023" rel="noreferrer nofollow noopener external" target="_blank">GitHub</a> and I recommend you download the project and follow along. It requires macOS 14 and Xcode 15. Currently I'm using macOS 14.0 beta 3 (23A5286g) and Xcode 15.0 beta 3 (15A5195k), but I will update this article with any changes as we work through the beta cycle.</p>
<p>Because Xcode 15 now supports live previews for Mac apps, you can test all the options from inside Xcode. In the Project navigator, expand the numbered groups and preview the first file in each group to view and interact with that data flow type.</p>
<p>Or go to the Bookmarks navigator where I've used the new bookmaking system to provide quick links to each one. You can even check off each one as you finish that section.</p>
<p>In the code snippets below, I include the essentials, but strip out most display modifiers and some similar views to keep the code short. The project contains the complete code.</p>
<p><a href="#top">Back to Top</a></p>
<hr>
<p><a id="property"></a></p>
<h3>Property</h3>
<p>The first option is using a static property. We get so caught up in property wrappers that it's easy to forget that SwiftUI doesn't always need them. Using static text from a constant may seem like a simplistic and obvious example, but separating it out allows for localization or re-usability as well as making the view body neater and easier to read.</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">Property</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
  <span class="token comment">// static property that never changes</span>
  <span class="token keyword">let</span> greeting <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Hello from SwiftUI!"</span></span>

  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token comment">// Using the property directly in a View</span>
    <span class="token class-name">Text</span><span class="token punctuation">(</span>greeting<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>My flow chart shows two use cases for <code>let</code>. This covers the first one where the view owns the property. The second is when a parent supplies the property to a view but the child view never changes the property. You'll see an example of this later on in this article.</p>
<p>A parent view may have some dynamic data that it uses to set properties in a subview where the subview only needs to display the data statically. This data will still change as the parent view changes but the subview will not be able to change the data itself or in the parent view.</p>
<blockquote>
<p>If a view owns a property or gets it from a parent but doesn't need to change it, use <code>let</code>.</p>
</blockquote>
<p><a href="#top">Back to Top</a></p>
<hr>
<p><a id="state"></a></p>
<h3>@State</h3>
<p>This is where things start to get interesting in the SwiftUI world. SwiftUI views are contained in structs, so are non-mutable. Also, views are re-created every time the data changes, so any properties are re-created then too. By marking a property with the <code>@State</code> property wrapper, you are telling SwiftUI that you want it to keep this data in a separate portion of memory, allow it to be mutated, and preserve the current value during view refreshes.</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">UsingState</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
  <span class="token comment">// Using @State as this view owns and can mutate the property</span>
  <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token number">0</span>

  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token comment">// Displaying and editing @State property</span>
    <span class="token class-name">VStack</span> <span class="token punctuation">{</span>
      <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Counter = </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">counter</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>

      <span class="token class-name">Button</span><span class="token punctuation">(</span>action<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        counter <span class="token operator">+=</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> label<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"plus.circle"</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>In this example, the <code>counter</code> property uses <code>@State</code>. The text view displays it and the <code>Button</code> view can change it. The button's action changes the counter which causes the view to redraw in order to display the new value, but the value of the <code>@State</code> property does not get reset to 0 every time.</p>
<blockquote>
<p>Whenever a view owns the property and that property is mutable, declare it using the <code>@State</code> property wrapper.</p>
</blockquote>
<p><a href="#top">Back to Top</a></p>
<hr>
<p><a id="binding"></a></p>
<h3>@Binding</h3>
<p>The Apple flow chart mentioned <code>@Bindable</code> but that only works with observable classes. For connecting structures or primitive data types to subviews, use <code>@Binding</code>. Apple does this internally for controls like <code>Toggle</code> and <code>TextField</code>.</p>
<p>A problem with building SwiftUI views is that it is very easy to end up with a gigantic <em>Pyramid of Doom</em> as you embed views within views within views. Extracting subviews is a great solution, but then you need a way to pass the data to a subview in a way that allows the subview to edit that property <strong>and</strong> have the edits flow back to the parent.</p>
<p>This is where <code>@Binding</code> and <code>@Bindable</code> come into play.</p>
<p>The <strong>Binding 1</strong> example uses a primitive data type - in this case an <code>Int</code>. The parent <code>Numbers</code> view declares it using <code>@State</code> because it owns the property, and it displays the value. The <code>Numbers</code> view passes the property to the <code>NumberChooser</code> subview as an <code>@Binding</code> property by using the <code>$</code> prefix.</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">Numbers</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
  <span class="token comment">// Using @State as this view owns and can mutate the property</span>
  <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> stepperValue <span class="token operator">=</span> <span class="token number">0</span>

  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token class-name">VStack</span> <span class="token punctuation">{</span>
      <span class="token comment">// Display @State property</span>
      <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Parent view value = </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">stepperValue</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>

      <span class="token comment">// Pass to subview as a Binding ($) for two-way editing</span>
      <span class="token class-name">NumberChooser</span><span class="token punctuation">(</span>stepperValue<span class="token punctuation">:</span> $stepperValue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>The <code>NumberChooser</code> subview has this property marked with <code>@Binding</code>. It has no initial value as this view expects to receive the value from its parent view. <code>NumberChooser</code> has a <code>Stepper</code> for changing the value of the property. It displays the value after each change and you can see that the value displayed in the parent view also changes as the change flows back.</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">NumberChooser</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
  <span class="token comment">// Using value from parent with 2-way binding</span>
  <span class="token attribute atrule">@Binding</span> <span class="token keyword">var</span> stepperValue<span class="token punctuation">:</span> <span class="token class-name">Int</span>

  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token class-name">VStack</span> <span class="token punctuation">{</span>
      <span class="token comment">// Using bound state from parent with 2-way binding</span>
      <span class="token class-name">Stepper</span><span class="token punctuation">(</span>value<span class="token punctuation">:</span> $stepperValue<span class="token punctuation">,</span> <span class="token keyword">in</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token operator">...</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Value in child = </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">stepperValue</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// Using bound state from parent as property</span>
      <span class="token comment">// this view cannot change the value</span>
      <span class="token class-name">NumberBlock</span><span class="token punctuation">(</span>stepperValue<span class="token punctuation">:</span> stepperValue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><code>NumberChooser</code> has its own subview - <code>NumberBlock</code>. This is purely a display view that never edits the value. <code>NumberChooser</code> passes it the value and it stores it as a <code>let</code>. Whenever the value changes, SwiftUI redraws the view with the new value, and the display updates. This demonstrates the second use of <code>let</code> that I talked about in the property section. There is no need to make this a <code>var</code> because it doesn't change - it gets re-created with every update.</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">NumberBlock</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
  <span class="token comment">// As this view never changes the value, there is no need to bind it</span>
  <span class="token keyword">let</span> stepperValue<span class="token punctuation">:</span> <span class="token class-name">Int</span>

  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token class-name">Image</span><span class="token punctuation">(</span>systemName<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">stepperValue</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">.square"</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><a href="#top">Back to Top</a></p>
<hr>
<p><a id="binding-for-a-structure"></a></p>
<h3>@Binding for a Structure</h3>
<p>The previous example showed how to use <code>@Binding</code> for a primitive data type like <code>Int</code>, <code>String</code> etc. But bindings also work for any value type, including structures, and that's what you can see in <strong>Binding 2</strong>.</p>
<p>While this is not very common, I enjoyed writing this example for a couple of reasons. Firstly, it shows how to draw the UI based on the different cases in an enum. Check out <strong>Pizza.swift</strong> which has three enums. Each of the picker views loops through one of these enums to draw the view.</p>
<p>Secondly, it demonstrates how you can pass portions of the data model to a subview, instead of sending everything everywhere.</p>
<p><code>PizzaView</code> has a <code>Pizza</code> property declared using <code>@State</code> because this view owns the data. It draws a <code>Form</code> containing three different pickers. Each picker gets a binding to one of the properties of the pizza. A <code>Text</code> view shows the assembled data to confirm that the parent knows about any changes.</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PizzaView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
  <span class="token comment">// Using @State for a struct</span>
  <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> pizza <span class="token operator">=</span> <span class="token class-name">Pizza</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token class-name">VStack</span> <span class="token punctuation">{</span>
      <span class="token class-name">Form</span> <span class="token punctuation">{</span>
        <span class="token comment">// Using 2-way binding but each component</span>
        <span class="token comment">// only needs 1 property from the struct</span>
        <span class="token class-name">PizzaNamePicker</span><span class="token punctuation">(</span>selectedPizzaName<span class="token punctuation">:</span> $pizza<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        <span class="token class-name">PizzaSizePicker</span><span class="token punctuation">(</span>selectedPizzaSize<span class="token punctuation">:</span> $pizza<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
        <span class="token class-name">PizzaCrustPicker</span><span class="token punctuation">(</span>selectedPizzaCrust<span class="token punctuation">:</span> $pizza<span class="token punctuation">.</span>crust<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// Text representation to prove that the</span>
      <span class="token comment">// subviews are modifying the parent struct</span>
      <span class="token class-name">Text</span><span class="token punctuation">(</span>pizza<span class="token punctuation">.</span>pizzaSelection<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>I won't show the code for all of the pickers, but here's the one to select the size:</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">PizzaSizePicker</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
  <span class="token comment">// A single property of the Pizza struct is passed hare.</span>
  <span class="token comment">// It's a Binding so data flows 2 ways.</span>
  <span class="token attribute atrule">@Binding</span> <span class="token keyword">var</span> selectedPizzaSize<span class="token punctuation">:</span> <span class="token class-name">PizzaSize</span>

  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token class-name">Section</span><span class="token punctuation">(</span>header<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Select your size:"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>headline<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">Picker</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">,</span> selection<span class="token punctuation">:</span> $selectedPizzaSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ForEach</span><span class="token punctuation">(</span><span class="token class-name">PizzaSize</span><span class="token punctuation">.</span>allCases<span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token punctuation">\</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> pizzaSize <span class="token keyword">in</span>
          <span class="token class-name">Text</span><span class="token punctuation">(</span>pizzaSize<span class="token punctuation">.</span>rawValue<span class="token punctuation">.</span>capitalized<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token punctuation">.</span><span class="token function">pickerStyle</span><span class="token punctuation">(</span><span class="token punctuation">.</span>segmented<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<blockquote>
<p>If you're passing a primitive data type or a struct to a subview, and the subview can change the value of this property, use <code>@Binding</code> in the subview and pass the property with a <code>$</code> prefix.</p>
</blockquote>
<p><a href="#top">Back to Top</a></p>
<hr>
<p><a id="observable-and-bindable"></a></p>
<h3>@Observable and @Bindable</h3>
<p>So far, the examples have been largely the same as before. Now the new property wrappers appear. The first big change is in the model class: <code>ColorSet</code>.</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">SwiftUI</span>
<span class="token keyword">import</span> <span class="token class-name">Observation</span>

<span class="token attribute atrule">@Observable</span> <span class="token keyword">class</span> <span class="token class-name">ColorSet</span> <span class="token punctuation">{</span>
  <span class="token comment">// Observable class</span>
  <span class="token comment">// The color components are not private so any changes</span>
  <span class="token comment">// get published to the views that are observing</span>

  <span class="token keyword">var</span> foregroundRed <span class="token operator">=</span> <span class="token number">0.0</span>
  <span class="token keyword">var</span> foregroundGreen <span class="token operator">=</span> <span class="token number">0.0</span>
  <span class="token keyword">var</span> foregroundBlue <span class="token operator">=</span> <span class="token number">0.0</span>

  <span class="token comment">// Computed variables to create the RGB colors from the components</span>
  <span class="token keyword">var</span> foregroundColor<span class="token punctuation">:</span> <span class="token class-name">Color</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">Color</span><span class="token punctuation">(</span>red<span class="token punctuation">:</span> foregroundRed<span class="token punctuation">,</span> green<span class="token punctuation">:</span> foregroundGreen<span class="token punctuation">,</span> blue<span class="token punctuation">:</span> foregroundBlue<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>The first thing to notice is the new import: <code>Observation</code>. This is the library that supports the new <code>@Observable</code> macro. Previously, <code>ColorSet</code> conformed to the <code>ObservableObject</code> protocol and the properties that needed to be observed were marked with the <code>@Published</code> property wrapper.</p>
<p>Now the class uses the <code>@Observable</code> macro and any property that isn't private, is automatically published. This is only available for classes, not structures.</p>
<p><a id="update-2"></a></p>
<h4>UPDATE 2:</h4>
<p><s>The properties must all have an initial value - setting them in an <code>init</code> is not sufficient and will not build.</s></p>
<p>In beta 3, observed properties no longer require an initial value. For this class, I actually want to specify initial values, but in the next section, I do not.</p>
<hr>
<p>If you want a look at what's happening inside the macro, right-click on <code>@Observable</code> and select <strong>Expand Macro</strong>. When you've finished, right -click again and choose <strong>Hide Macro Expansion</strong>.</p>
<p><img src="/images/2023/show_macro.png" alt="Expand the macro"></p>
<p>While this is not something I can read comfortably, it shows how macros are regular Swift code that saves a lot of typing, but are not doing magical things invisibly in the background.</p>
<p>Now that the model uses the new macro, how do we use it?</p>
<p>Again, the owning view declares it using <code>@State</code>.</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">ColorSetView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
  <span class="token comment">// Using an Observable for reference-based data (classes)</span>
  <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> colorSet <span class="token operator">=</span> <span class="token class-name">ColorSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre>
<p>The <code>ColorSetView</code> uses the data to add color modifiers to the view background and to a system image of a cat.</p>
<p>But the next change is when sending the data to the <code>ColorChooser</code> view. This needs two-way binding so the current values can be passed to the chooser and any changes can be passed back. But with the new Observation methods, this uses <code>@Bindable</code> and not <code>@Binding</code>.</p>
<p>First, the <code>ColorChooser</code> gets the <code>colorSet</code> property, but this doesn't need the <code>$</code> prefix.</p>
<pre class="language-swift"><code class="language-swift"><span class="token class-name">ColorChooser</span><span class="token punctuation">(</span>colorSet<span class="token punctuation">:</span> colorSet<span class="token punctuation">)</span></code></pre>
<p>The <code>ColorChooser</code> view receives it as <code>@Bindable</code> and can in turn, pass it down to its subviews, again using the <code>@Bindable</code> technique which requires no <code>$</code> prefixes.</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">ColorChooser</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
  <span class="token attribute atrule">@Bindable</span> <span class="token keyword">var</span> colorSet<span class="token punctuation">:</span> <span class="token class-name">ColorSet</span>

  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token comment">// The chooser subview also get passed the Observed</span>
    <span class="token class-name">ForeColorChooser</span><span class="token punctuation">(</span>colorSet<span class="token punctuation">:</span> colorSet<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><img src="/images/2023/color_chooser.png" alt="Color chooser"></p>
<p>There is one oddity to beware of. When declaring the original <code>colorSet</code> property, I use <code>@State</code> but if I declare it as a simple <code>var</code>, the app still works. Don't do this!</p>
<p>If you remember the older code style, the owning view initialized an <code>ObservableObject</code> using <code>@StateObject</code>. Subsequent views declared the same property using <code>@ObservedObject</code> but it was very important for the owning view to use <code>@StateObject</code> to avoid strange and difficult to trace bugs. The app worked if you used <code>@ObservedObject</code> instead of <code>@StateObject</code> for the original declaration, but then odd things could happen.</p>
<p>I think this is the same, and it's just as important for the owning view to declare the original property using <code>@State</code>.</p>
<p><a href="#top">Back to Top</a></p>
<hr>
<p><a id="observable-and-bindable-list"></a></p>
<h3>@Observable and @Bindable List</h3>
<p>In the original post, this was the section that gave me the most trouble - having a list of data objects where each one could be edited and updating the original list to show the edits.</p>
<p>This is now a lot easier, although it took me some time to realize this.</p>
<p>I have a sample data file and a <code>Person</code> model class using <code>@Observable</code>. The <code>PersonListModel</code> class holds an array of these <code>Person</code> objects and it also uses <code>@Observable</code>.</p>
<p>I wanted to make the selection of the list point directly to a <code>Person</code> instead of going through an <code>id</code>, so I added this extension to <code>Person</code>:</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">extension</span> <span class="token class-name">Person</span><span class="token punctuation">:</span> <span class="token class-name">Hashable</span><span class="token punctuation">,</span> <span class="token class-name">Equatable</span> <span class="token punctuation">{</span>
  <span class="token keyword">func</span> <span class="token function-definition function">hash</span><span class="token punctuation">(</span>into hasher<span class="token punctuation">:</span> <span class="token keyword">inout</span> <span class="token class-name">Hasher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    hasher<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token keyword">func</span> <span class="token operator">==</span><span class="token punctuation">(</span>lhs<span class="token punctuation">:</span> <span class="token class-name">Person</span><span class="token punctuation">,</span> rhs<span class="token punctuation">:</span> <span class="token class-name">Person</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">Bool</span> <span class="token punctuation">{</span>
    lhs<span class="token punctuation">.</span>id <span class="token operator">==</span> rhs<span class="token punctuation">.</span>id
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Then I was able to set up a <code>List</code> to display the names of the people, with the list's selection bound to an optional <code>Person</code>. I had to add a <code>tag</code> to the person, I presume the tag is set to the <code>id</code> by default.</p>
<pre class="language-swift"><code class="language-swift"><span class="token class-name">List</span><span class="token punctuation">(</span>selection<span class="token punctuation">:</span> $selectedPerson<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">ForEach</span><span class="token punctuation">(</span>$personList<span class="token punctuation">.</span>persons<span class="token punctuation">)</span> <span class="token punctuation">{</span> $person <span class="token keyword">in</span>
    <span class="token class-name">Text</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>fullName<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">tag</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Two important things to see in this code snippet:</p>
<ul>
<li>The contents of the <code>ForEach</code> is a binding as you can see from the <code>$</code> prefix</li>
<li>The argument passed in to each entry in the list is also a binding.</li>
</ul>
<p>These two bindings make the list respond to edits.</p>
<p>With this in place, it was time to think about an editor and I decided to try out the new inspector. Unfortunately, unlike with sheets, you can only trigger an inspector with a Boolean so I added an event listener to set the inspector trigger:</p>
<pre class="language-swift"><code class="language-swift"><span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span>of<span class="token punctuation">:</span> selectedPerson<span class="token punctuation">,</span> <span class="token punctuation">{</span> oldValue<span class="token punctuation">,</span> newValue <span class="token keyword">in</span>
  shouldShowInspector <span class="token operator">=</span> newValue <span class="token operator">!=</span> <span class="token nil constant">nil</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>After that, I added this inspector modifier:</p>
<pre class="language-swift"><code class="language-swift"><span class="token punctuation">.</span><span class="token function">inspector</span><span class="token punctuation">(</span>isPresented<span class="token punctuation">:</span> $shouldShowInspector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token keyword">let</span> selectedPerson <span class="token punctuation">{</span>
    <span class="token class-name">PersonEditView</span><span class="token punctuation">(</span>person<span class="token punctuation">:</span> selectedPerson<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Even though <code>shouldShowInspector</code> is only true when there is a valid <code>selectedPerson</code>, force unwrapping causes a crash as it appears that the inspector tries to draw itself off-screen on launch.</p>
<p>The <code>PersonEditView</code> in the inspector receives the person as <code>@Bindable</code> and populates the fields on a form. And editing the data flows right back to the list.</p>
<p><img src="/images/2023/person_edit.mp4" alt="Editing a person"></p>
<p>This took a lot less code than the previous version. Part of the improvement was the ability to use bindings in a list, which we got last year, but another big part was using the <code>Person</code> directly as the selection. This needs the <code>Hashable</code> and <code>Equatable</code> conformance, which I think should be a standard part of <code>Identifiable</code>, but once that's in place, all the data flows smoothly.</p>
<p>If I was using a sheet for the editor, it would be even neater as I could tie the sheet's appearance to <code>selectedPerson</code>.</p>
<blockquote>
<p>When you have a model class and you want changes to be published, declare the class with the <code>@Observable</code> macro. The owning view declares the model using <code>@State</code> and can pass it to editing subviews using <code>@Bindable</code> or to display subviews as <code>let</code>.</p>
</blockquote>
<p><a href="#top">Back to Top</a></p>
<hr>
<p><a id="environment"></a></p>
<h3>@Environment</h3>
<p>The last section is <code>Environment</code>, which again, has changed a lot. The benefit of using Environment is that the data flow doesn't have to be unbroken. In the sample app, the parent view (NestedViews) uses the Environment property and so does the GrandChildView, but the ChildView in the middle doesn't.</p>
<p>Setting up a property for Environment is the same as for Observable.</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">Observation</span>

<span class="token comment">// An Environment class is just like any Observable class</span>
<span class="token attribute atrule">@Observable</span> <span class="token keyword">class</span> <span class="token class-name">UserSettings</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> isLoggedIn<span class="token punctuation">:</span> <span class="token class-name">Bool</span> <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span></code></pre>
<p>The difference is in the way that you use it. When creating the first view that needs this environment value, use an <code>environment</code> modifier to inject the initial value. In the sample app, this happens in <strong>DataLink.swift</strong> which displays the view for each example.</p>
<pre class="language-swift"><code class="language-swift"><span class="token class-name">NestedViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">(</span><span class="token class-name">UserSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p>To access this property, declare an <code>Environment</code> property with a key path, which is its type, in this case <code>UserSettings.self</code>.</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">NestedViews</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
  <span class="token comment">// The injected environment property is accessed by type and assigned a name</span>
  <span class="token attribute atrule">@Environment</span><span class="token punctuation">(</span><span class="token class-name">UserSettings</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">var</span> userSettings

  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>This is similar the way we use built-in environment values like <code>colorScheme</code>, <code>openWindow</code> and so on. Use this same declaration in any view that needs access.</p>
<p>Previews need to get access too, like this:</p>
<pre class="language-swift"><code class="language-swift"><span class="token other-directive property">#Preview</span> <span class="token punctuation">{</span>
  <span class="token comment">// The environment object must be injected into the preview too.</span>
  <span class="token class-name">NestedViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">(</span><span class="token class-name">UserSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>And even though ChildView doesn't use the environment object, because its preview contains GrandChildView that does, it also needs the <code>environment</code> modifier in its preview, but not in the main view code.</p>
<p>In the sample app, the various nested views are brightly colored to show which is which. Using the <strong>Log In</strong> or <strong>Log Out</strong> buttons works on either the outer view or the inner view with the data being synced between them.</p>
<p><img src="/images/2023/environment.png" alt="Environment"></p>
<blockquote>
<p>If you have a class that is global to your app, like UserSettings in this example, declare the class with the <code>@Observable</code> macro. Inject it into your view hierarchy using <code>.environment</code> and then use <code>@Enviroment</code> to access it.</p>
</blockquote>
<p><a id="update-3"></a></p>
<h4>UPDATE 3:</h4>
<p>There is one aspect of using <code>@Enviroment</code> where things get tricky, and that's if you need to use any properties of the environment object as bindings for other controls.</p>
<p>I added a <code>Toggle</code> to <code>GrandChildView</code> and wanted to connect it to the same <code>userSettings.isLoggedIn</code> Boolean. A toggle takes a binding, so normally, I'd do this by adding the <code>$</code> prefix to the property to bind.</p>
<p>With <code>@Environment</code>, this gives an error:</p>
<p><img src="/images/2023/env_binding.png" alt="Binding error"></p>
<p>The solution is to create an intermediary <code>@Bindable</code> property from the <code>@Environment</code> property and bind it to the toggle (or any control that needs a binding).</p>
<p>Stripping out a lot of what was there, the code becomes:</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">GrandChildView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
  <span class="token attribute atrule">@Environment</span><span class="token punctuation">(</span><span class="token class-name">UserSettings</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token keyword">var</span> userSettings

  <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token attribute atrule">@Bindable</span> <span class="token keyword">var</span> userSettingsBindable <span class="token operator">=</span> userSettings

    <span class="token class-name">Toggle</span><span class="token punctuation">(</span>isOn<span class="token punctuation">:</span> $userSettingsBindable<span class="token punctuation">.</span>isLoggedIn<span class="token punctuation">,</span> label<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Log In Status"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>You declare the <code>@Environment</code> property as usual, then <strong>inside</strong> the <code>body</code>, declare an <code>@Bindable</code> property with the value from the <code>@Environment</code> property. You have to do this inside the body because doing it outside gives an error.</p>
<p>Surprisingly, I didn't have to add a <code>return</code> before the Toggle, even though it was no longer the only statement in the body.</p>
<p>Thanks to <a href="https://iosdev.space/@StewartLynch" rel="noreferrer nofollow noopener external" target="_blank">Stewart Lynch</a> for suggesting I add this. Hopefully it will be fixed soon but until then, this is the workaround.</p>
<p><a href="#top">Back to Top</a></p>
<hr>
<p><a id="wrapping-up"></a></p>
<h3>Wrapping Up</h3>
<p>There are two issues I want to discuss before ending.</p>
<p>First is the use of <code>private</code> for view properties. Apple recommends marking every <code>@State</code> property as <code>private</code>. It seems a bit strange as you then pass them around and sometimes the subviews change the data, but it means that no object can edit the value unless the view has expressly given permission. I presume there are security and performance benefits to this.</p>
<p>Similarly, <code>@Enviroment</code> properties can (and I presume, should) be private. The two binding property wrappers do not allow their properties to be private.</p>
<p>And lastly, in <code>@Observable</code> classes, everything that is <strong>NOT</strong> private is published. This is the opposite to what we had before where you had to explicItly state which properties were published. So mark properties as <code>private</code> if they should not be published.</p>
<p>The other issue is to do with using <code>var</code> on its own i.e. without any property wrapper. The Apple flow chart suggests doing this if you get to the end of the flow without making any other decision, but I think you should use <code>let</code> in this case. The only time I use a plain <code>var</code> in a view is for computed properties, otherwise I use <code>let</code>.</p>
<p>In my flow chart, I left the appropriate end point showing <strong>var or let</strong>, to better match Apple's, but I recommend using <code>let</code> and only changing to <code>var</code> if Xcode complains. This is a good rule for any Swift code, not just SwiftUI.</p>
<hr>
<p>This article may get several updates before we exit this years beta cycle, but I thought other people might find it useful. Writing it certainly helped clarify the new options in my head.</p>
<p>If you have any suggestions, ideas or corrections, please contact me using one of the links below or through the <a href="/contact/">Contact</a> page. And if you found this article useful, I'd love you to <a href="https://ko-fi.com/trozware" rel="noreferrer nofollow noopener external" target="_blank">buy me a coffee</a>.</p>
<p><a href="#top">Back to Top</a></p>

        </article>
    </section>

    </main>
    <footer>
        <div class="footer-content">
  <nav>
    <ul class="footer-links">
      
        <li>
          <a href="mailto:info@troz.net">
            <img src="/images/links/envelope.svg" alt="Email" title="Email" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://mastodon.social/@troz" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/mastodon.png" alt="Mastodon" title="Mastodon" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://linktr.ee/trozware" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/tree.svg" alt="Linktree" title="Linktree" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://github.com/trozware" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/github.svg" alt="GitHub" title="GitHub" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://stackoverflow.com/users/1082632" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/stack-overflow.svg" alt="Stack Overflow" title="Stack Overflow" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://dev.to/trozware" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/dev-badge.svg" alt="Dev To" title="Dev To" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="/index.xml">
            <img src="/images/links/rss.svg" alt="RSS Feed" title="RSS Feed" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="/atom.xml">
            <img src="/images/links/atom.svg" alt="Atom Feed" title="Atom Feed" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="/feed.json">
            <img src="/images/links/json.png" alt="JSON Feed" title="JSON Feed" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://ko-fi.com/trozware" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/kofi1.png.webp" alt="Buy Me a Coffee" title="Buy Me a Coffee" height="30px" >
          </a>
        </li>
      
    </ul>
  </nav>
</div>

        <div class="copyright">
            <p>Copyright &copy; 2025 Sarah Reichelt, TrozWare</p>
        </div>
    </footer>

    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            let searchElement = document.getElementById('search');
            if (searchElement) {
                new PagefindUI({ element: searchElement, showSubResults: true });
            }
        });
    </script>
    <script src="/js/theme_switcher.js"></script>
    <script src="/js/clipboard.js"></script>
    <script src="/js/menu.js"></script>
</body>
</html>
