<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Day</title>
    
    <link href="/styles/style.css" rel="stylesheet" >


    <link href="/styles/prism.css" rel="stylesheet" >



<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js"></script>
<style>
@media (prefers-color-scheme: dark) {
    :root {
    --pagefind-ui-primary: #eeeeee;
    --pagefind-ui-text: #eeeeee;
    --pagefind-ui-background: #152028;
    --pagefind-ui-border: #152028;
    --pagefind-ui-tag: #152028;
    }
}
</style>
    











  


<meta property="og:site_name" content="TrozWare" >
<meta property="og:title" content="To-Day - TrozWare" >
<meta property="og:type" content="website" >
<meta property="og:url" content="https://troz.net/post/2023/to-day/" >
<meta name="keywords" content="Mac app development, Apple Mac, Xcode, Swift, SwiftUI, Apple macOS, books, articles, blog, apps, developer, author, Sarah Reichelt">




  <meta name="description" content="Crazy Mac lady. Mac author &amp; developer. Lover of Apple computers and devices. Swift &amp; SwiftUI enthusiast. Unofficial Mac app dev evangelist" >
  <meta property="og:description" content="Crazy Mac lady. Mac author &amp; developer. Lover of Apple computers and devices. Swift &amp; SwiftUI enthusiast. Unofficial Mac app dev evangelist" >



<link rel="alternate" type="application/rss+xml" href="/index.xml" title="TrozWare">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="TrozWare">
<link rel="alternate" type="application/json" href="/feed.json" title="TrozWare">


<link rel="icon" type="image/png" href="/images/favicon.png">

    <link rel="icon" href="/favicon.ico" sizes="32x32">
<link rel="icon" href="/icon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
</head>

<body>
    <header>
  <nav class="container">
    <div class="nav-brand">
      <a href="/" class="site-title">TrozWare</a>
      <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">
        <span class="hamburger"></span>
      </button>
    </div>

    <ul class="nav-links">
      
        <li>
          <a href="/" class="nav-link">Home</a>
        </li>
      
        <li>
          <a href="/books/" class="nav-link">Books</a>
        </li>
      
        <li>
          <a href="/apps/" class="nav-link">Apps</a>
        </li>
      
        <li>
          <a href="/archives/" class="nav-link">Archives</a>
        </li>
      
        <li>
          <a href="/tags/" class="nav-link">Tags</a>
        </li>
      
        <li>
          <a href="/contact/" class="nav-link">Contact</a>
        </li>
      

      <li>
        <button           class="theme-toggle"
          type="button"
          title="Toggle theme"
          aria-label="Toggle theme"
          onclick="toggleTheme()"
        >
          <svg             xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
            width="1em"
            height="1em"
            class="theme-toggle__dark-side"
            fill="currentColor"
            viewBox="0 0 32 32"
          >
            <path d="M16 .5C7.4.5.5 7.4.5 16S7.4 31.5 16 31.5 31.5 24.6 31.5 16 24.6.5 16 .5zm0 28.1V3.4C23 3.4 28.6 9 28.6 16S23 28.6 16 28.6z" ></path>
          </svg>
        </button>
      </li>
    </ul>
  </nav>
</header>

    
	<main>
        
    <section class="post">
        <h1 data-pagefind-meta="title">To-Day</h1>

        <p>
            8th March 2023 • 1,625 words • 8 minutes  reading time.
        </p>

        <div class="tag-list">
            
                <a href="/tags/#app-store" class="tag-button">#App Store</a>
            
                <a href="/tags/#apps" class="tag-button">#Apps</a>
            
                <a href="/tags/#menu-bar" class="tag-button">#Menu Bar</a>
            
                <a href="/tags/#swiftui" class="tag-button">#SwiftUI</a>
            
                <a href="/tags/#macos" class="tag-button">#macOS</a>
            
        </div>

        <article data-pagefind-body>
            <p>When I sit down at my computer at the start of a work day, I typically like to plan out the broad outline of my work. This is the three or four major tasks for my day. I don't want a minute-by-minute plan, just a list of the major items, so that I can check them off as I work, and get to the end of the day without feeling like I've forgotten anything.</p>
<p>There are a ton of todo apps and web services available, but they all provide much more than I need. When I factored in how I wanted to learn about writing a Mac menubar app in SwiftUI, the solution was obvious - write my own.</p>

<p>First things first: the project is open-source and on <a href="https://github.com/trozware/To-Day" rel="noreferrer nofollow noopener external" target="_blank">GitHub</a> so feel free to download it, fork it, edit it, create pull requests, file issues or whatever you like. If you just want to install the app, you can download the <a href="https://github.com/trozware/To-Day/raw/main/Releases/To-Day.dmg" rel="noreferrer nofollow noopener external" target="_blank">disk image</a>. It requires macOS 13.0 or later.</p>
<p><img src="/images/2023/today1.png" alt="Running the app for the first time"></p>
<p>I'm not going to go through the entire app in detail. You can download the project and check out the code to see it all. I'm just going to give some details about the app structure and architecture as well as mentioning some code that I found new or interesting.</p>
<h2>The App</h2>
<p>I've written menu bar apps using AppKit but this is my first serious look at SwiftUI's <code>MenuBarExtra</code>. Configuring the app to be a menu bar app has three steps:</p>
<ol>
<li>Remove the <code>WindowGroup</code> from your app <code>body</code>.</li>
<li>Add a <code>MenuBarExtra</code> to your app <code>body</code> with some views to show in the menu.</li>
<li>Insert an entry into <strong>Target - Info</strong>, setting <code>Application is agent (UIElement)</code> to <code>YES</code>.</li>
</ol>
<p><img src="/images/2023/today_info.png" alt="Editing the app info"></p>
<p>You can then delete <strong>ContentView.swift</strong> from the project since nothing uses it.</p>
<p>Looking at the first screenshot, you can see that I've split the menu into four sections. The first one displays the actual todos and handles checking them off. This view is provided by the main data object.</p>
<p>The other sections are static and deal with editing the todos, configuring the app settings and managing the app itself. Each of these is split off into a separate view file to keep the main app body as uncluttered as possible. The files for these three sections are in the <strong>Menu Views</strong> group in the Xcode project.</p>
<p>Editing the todos caused the most issues with the app and took several iterations, but I'm pleased with this version:</p>
<p><img src="/images/2023/today_edits.png" alt="Editing the todos"></p>
<p>I tried lots of ways of tracking the focus and adding keyboard commands to move items up and down the list but in the end, I went for simplicity. The editing is embedded in a <code>Form</code>. This means that I get the standard tabbing behaviour by default, but I also get the small toggle switches, which I really like.</p>
<p>The main view for this is <code>EditView</code> and it, with its subviews, are in the <strong>Edit Views</strong> project group.</p>
<p>I'll discuss the <strong>Models</strong> group and the data flow in a minute, but to finish describing the app structure, the <code>AboutView</code> tells you more about the app. I love being able to use basic Markdown styling in <code>Text</code> views. And I learnt a good lesson: if you're having trouble with truncated text, check out the <code>fixedSize</code> modifier.</p>
<p>Finally, <code>Updater</code> is a class to handle using the <strong><a href="https://sparkle-project.org" rel="noreferrer nofollow noopener external" target="_blank">Sparkle</a></strong> updater, which deserves its own post. I must have made every possible mistake when implementing this, so I think a guide would be useful, for future me if for nobody else.</p>
<h2>The Data</h2>
<p>I like to use the <a href="https://swiftuivoodo.com" rel="noreferrer nofollow noopener external" target="_blank">VOODO</a> pattern, which stands for <strong>View - ObservableObject - DataObject</strong>. Working backwards through this, the <strong>DataObject</strong> is a struct that contains the properties for a single <code>Todo</code> item. The <strong>ObservableObject</strong> is a class called <code>AppState</code> that contains a published array of todo items as well as a <code>DataStore</code> struct for saving and loading. The <strong>View</strong> is the menu itself.</p>
<p><code>AppState</code> also contains a bunch of computed properties to make life easier and methods for adding, deleting and checking. It also has a computed property to generate the view for the todos at the top of the menu.</p>
<p>When you have an <code>ObservableObject</code>, you can pass it around the app in two ways: as an <code>ObservedObject</code> or as an <code>EnvironmentObject</code>. Both work fine, but with the ObservedObject, there has to be an unbroken chain of data passing from view to subview to sub-subview and so on. EnvironmentObject makes it easier because once you insert it into a view hierarchy, any view in that hierarchy can access it.</p>
<p>It might seem like EnvironmentObject is less efficient, but I've read recent reports of it using less memory, perhaps because intermediate views that don't need it, don't access it.</p>
<p>I decided to use EnvironmentObject so in the App struct, I initialised it as a <code>StateObject</code>. MenuBarExtra can't take an <code>environmentObject</code>, so I grouped the menu view sections and assigned the environmentObject to the Group. This let the views in the menu access it using <code>@EnvironmentObject var appState: AppState</code>.</p>
<h2>Windows</h2>
<p>Even though this is a menu bar app, I wanted to be able to open two windows: one for editing the todos and one for showing some info about the app.</p>
<p>For each of these, I added a <code>Window</code> scene to the app. A <code>Window</code> scene differs from a <code>WindowGroup</code> in that it only opens one copy of the window. If you try to to open it a second time, it activates the original rather than opening another.</p>
<p>Back of these windows has a <code>title</code> and an <code>id</code>. The <code>id</code> is used by the <code>openWindow</code> <code>Environment</code> value to show the window and the title is the window title. The contents of the scene is the view that appears in the window.</p>
<p>The Edit window also gets the <code>EnvironmentObject</code> so it can access the data. Both have a <code>defaultSize</code> - this only applies to the first opening - after that, the app uses whatever you set. The About window also gets a <code>defaultPosition</code> (which I am not sure works) and a <code>windowResizability</code> modifier to make sure that the window can't be bigger than the size needed to show the content.</p>
<h2>Launch on Login</h2>
<p>Getting an app to launch when the user logins in used to be a lot of work. Thankfully, we now have access to <code>SMAppService</code> which makes it much easier. And that's why the app is only for macOS 13 or higher.</p>
<p>To tell whether an app is set to launch on login, import the <code>ServiceManagement</code> library and run this code:</p>
<pre class="language-swift"><code class="language-swift"><span class="token class-name">SMAppService</span><span class="token punctuation">.</span>mainApp<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token punctuation">.</span>enabled</code></pre>
<p>And to change the setting, use:</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">try</span> <span class="token class-name">SMAppService</span><span class="token punctuation">.</span>mainApp<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>Or:</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">try</span> <span class="token class-name">SMAppService</span><span class="token punctuation">.</span>mainApp<span class="token punctuation">.</span><span class="token function">unregister</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p>The really neat thing about this is that people can now see what apps will launch on login, unlike with the previous system where this data was hidden deep in the Library folder. Go to <strong>System Settings - General - Login Items</strong> to check it out.</p>
<h2>Saving Changes</h2>
<p>I wanted to save the todos whenever the user made a change, but with a debounce so it didn't save after every keystroke.</p>
<p>After a bit of research, this is what I used:</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">var</span> saveTask<span class="token punctuation">:</span> <span class="token class-name">DispatchWorkItem</span><span class="token operator">?</span>

<span class="token keyword">func</span> <span class="token function-definition function">debouncedSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">self</span><span class="token punctuation">.</span>saveTask<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">let</span> task <span class="token operator">=</span> <span class="token class-name">DispatchWorkItem</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token keyword">weak</span> <span class="token keyword">self</span><span class="token punctuation">]</span> <span class="token keyword">in</span>
    <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span><span class="token function">global</span><span class="token punctuation">(</span>qos<span class="token punctuation">:</span> <span class="token punctuation">.</span>background<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token keyword">weak</span> <span class="token keyword">self</span><span class="token punctuation">]</span> <span class="token keyword">in</span>
      <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token keyword">self</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>dataStore<span class="token punctuation">.</span><span class="token function">saveTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>todos<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">self</span><span class="token punctuation">.</span>saveTask <span class="token operator">=</span> task
  <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span><span class="token function">asyncAfter</span><span class="token punctuation">(</span>deadline<span class="token punctuation">:</span> <span class="token class-name">DispatchTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">,</span> execute<span class="token punctuation">:</span> task<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre>
<p>I added a <code>didSet</code> property observer to the <code>todos</code> array, which calls this function after every change. This cancels any existing task, creates a new one and schedules it for half a second later. If no other changes occur in that half-second, the app saves, using a background queue.</p>
<p>The <code>DataStore</code> struct saves and loads the data as JSON, storing it in the Documents folder inside the app's Container.</p>
<h2>Distribution</h2>
<p>Typically, I use the App Store to distribute my apps. Apple handles all the business side of things and it makes distributing updates easy.</p>
<p>But lately, it seems that the App Store review process has become even more capricious, blocking good apps for spurious reasons, while utterly failing in their stated mission of &quot;keeping us safe&quot; from obvious scams, copycat apps and fake reviews.</p>
<p>So for this app, I have decided not to charge for it and to distribute it myself. I'm using GitHub both as the <a href="https://github.com/trozware/To-Day" rel="noreferrer nofollow noopener external" target="_blank">open-source repository</a>, and as the <a href="https://github.com/trozware/To-Day/raw/main/Releases/To-Day.dmg" rel="noreferrer nofollow noopener external" target="_blank">app distribution source</a>.</p>
<p>If you enjoy using the app, I'd love to hear from you. There are contact details at the bottom of the page. And if you really want to contribute, please <a href="https://ko-fi.com/H2H3BU7SI" rel="noreferrer nofollow noopener external" target="_blank">buy me a coffee</a>.</p>
<p>Updating is the missing piece in this puzzle, but that is a sufficiently large topic that I intend to write a follow-up post detailing how I set up <a href="https://sparkle-project.org" rel="noreferrer nofollow noopener external" target="_blank">Sparkle</a> and eventually got it to work.</p>
<h2>Conclusion</h2>
<p>So, how does this compare with writing a Mac menu bar app in AppKit? A lot of things are easier in SwiftUI, but one thing I miss is being able to set up a menu delegate to track when the menu is opened or closed. There doesn't appear to be any way to do this for a <code>MenuBarExtra</code> - it can't have an <code>onAppear</code> or <code>onDisappear</code> modifier and <code>scenePhase</code> detects nothing.</p>
<p>For this app, it's not really a problem, but I have used other apps where it would be a real showstopper.</p>
<p>And what's next for this app? I'll use it in my daily routine for a while and see what I like, what I hate and what extra features I'd like. One possibility is to add some global shortcuts. This requires hooking into the Accessibility settings, which I am reluctant to do, so I'll need to think about this.</p>
<p>If you have any ideas or feature requests, create an issue on GitHub, or fork and edit the project and then create a pull request.</p>
<p><img src="/images/2023/todo_complete.png" alt="Day complete"></p>

        </article>
    </section>

    </main>
    <footer>
        <div class="footer-content">
  <nav>
    <ul class="footer-links">
      
        <li>
          <a href="mailto:info@troz.net">
            <img src="/images/links/envelope.svg" alt="Email" title="Email" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://mastodon.social/@troz" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/mastodon.png" alt="Mastodon" title="Mastodon" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://linktr.ee/trozware" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/tree.svg" alt="Linktree" title="Linktree" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://github.com/trozware" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/github.svg" alt="GitHub" title="GitHub" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://stackoverflow.com/users/1082632" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/stack-overflow.svg" alt="Stack Overflow" title="Stack Overflow" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://dev.to/trozware" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/dev-badge.svg" alt="Dev To" title="Dev To" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="/index.xml">
            <img src="/images/links/rss.svg" alt="RSS Feed" title="RSS Feed" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="/atom.xml">
            <img src="/images/links/atom.svg" alt="Atom Feed" title="Atom Feed" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="/feed.json">
            <img src="/images/links/json.png" alt="JSON Feed" title="JSON Feed" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://ko-fi.com/trozware" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/kofi1.png.webp" alt="Buy Me a Coffee" title="Buy Me a Coffee" height="30px" >
          </a>
        </li>
      
    </ul>
  </nav>
</div>

        <div class="copyright">
            <p>Copyright &copy; 2025 Sarah Reichelt, TrozWare</p>
        </div>
    </footer>

    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            let searchElement = document.getElementById('search');
            if (searchElement) {
                new PagefindUI({ element: searchElement, showSubResults: true });
            }
        });
    </script>
    <script src="/js/theme_switcher.js"></script>
    <script src="/js/clipboard.js"></script>
    <script src="/js/menu.js"></script>
</body>
</html>
