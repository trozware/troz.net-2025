<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwiftUI Snapshot Testing</title>
    
    <link href="/styles/style.css" rel="stylesheet" >


    <link href="/styles/prism.css" rel="stylesheet" >



<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js"></script>
<style>
@media (prefers-color-scheme: dark) {
    :root {
    --pagefind-ui-primary: #eeeeee;
    --pagefind-ui-text: #eeeeee;
    --pagefind-ui-background: #152028;
    --pagefind-ui-border: #152028;
    --pagefind-ui-tag: #152028;
    }
}
</style>
    











  


<meta property="og:site_name" content="TrozWare" >
<meta property="og:title" content="SwiftUI Snapshot Testing - TrozWare" >
<meta property="og:type" content="website" >
<meta property="og:url" content="https://troz.net/post/2020/swiftui_snapshots/" >
<meta name="keywords" content="Mac app development, Apple Mac, Xcode, Swift, SwiftUI, Apple macOS, books, articles, blog, apps, developer, author, Sarah Reichelt">




  <meta name="description" content="Crazy Mac lady. Mac author &amp; developer. Lover of Apple computers and devices. Swift &amp; SwiftUI enthusiast. Unofficial Mac app dev evangelist" >
  <meta property="og:description" content="Crazy Mac lady. Mac author &amp; developer. Lover of Apple computers and devices. Swift &amp; SwiftUI enthusiast. Unofficial Mac app dev evangelist" >



<link rel="alternate" type="application/rss+xml" href="/index.xml" title="TrozWare">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="TrozWare">
<link rel="alternate" type="application/json" href="/feed.json" title="TrozWare">


<link rel="icon" type="image/png" href="/images/favicon.png">

    <link rel="icon" href="/favicon.ico" sizes="32x32">
<link rel="icon" href="/icon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
</head>

<body>
    <header>
  <nav class="container">
    <div class="nav-brand">
      <a href="/" class="site-title">TrozWare</a>
      <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">
        <span class="hamburger"></span>
      </button>
    </div>

    <ul class="nav-links">
      
        <li>
          <a href="/" class="nav-link">Home</a>
        </li>
      
        <li>
          <a href="/books/" class="nav-link">Books</a>
        </li>
      
        <li>
          <a href="/apps/" class="nav-link">Apps</a>
        </li>
      
        <li>
          <a href="/archives/" class="nav-link">Archives</a>
        </li>
      
        <li>
          <a href="/tags/" class="nav-link">Tags</a>
        </li>
      
        <li>
          <a href="/contact/" class="nav-link">Contact</a>
        </li>
      

      <li>
        <button           class="theme-toggle"
          type="button"
          title="Toggle theme"
          aria-label="Toggle theme"
          onclick="toggleTheme()"
        >
          <svg             xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
            width="1em"
            height="1em"
            class="theme-toggle__dark-side"
            fill="currentColor"
            viewBox="0 0 32 32"
          >
            <path d="M16 .5C7.4.5.5 7.4.5 16S7.4 31.5 16 31.5 31.5 24.6 31.5 16 24.6.5 16 .5zm0 28.1V3.4C23 3.4 28.6 9 28.6 16S23 28.6 16 28.6z" ></path>
          </svg>
        </button>
      </li>
    </ul>
  </nav>
</header>

    
	<main>
        
    <section class="post">
        <h1 data-pagefind-meta="title">SwiftUI Snapshot Testing</h1>

        <p>
            17th May 2020 • 2,104 words • 11 minutes  reading time.
        </p>

        <div class="tag-list">
            
                <a href="/tags/#snapshot" class="tag-button">#Snapshot</a>
            
                <a href="/tags/#swiftui" class="tag-button">#SwiftUI</a>
            
                <a href="/tags/#unit-tests" class="tag-button">#Unit Tests</a>
            
        </div>

        <article data-pagefind-body>
            <p>Snapshot testing is a technique that has been very popular in the web development world and it seems like a great way to test SwiftUI user interfaces. I read about snapshot tests in a recent blog post and was intrigued, but I had some difficulty getting it to work, so when I finally succeeded, I decided to share my experiences in the hope that others will find them useful.</p>

<hr>
<h2>What is Snapshot Testing</h2>
<p>Unit testing checks that when you call various functions or methods with certain inputs, you get the output you expect. I use unit tests for testing my models and the methods that change them. But this only tests the logic behind the app, it does nothing to test whether the app is displaying what it should, or whether it is responding correctly to the user's actions.</p>
<p>UI testing emulates user actions by faking taps, clicks, text entry and so on and checks that labels, buttons etc are showing the correct information after these fake interactions.</p>
<p>Snapshot testing is in between these two as it effectively takes a picture of the interface. The first time you run the test it will store an image and all subsequent test runs will check that the current interface matches this stored image. If there are any differences, the test will fail so you can decide whether to keep the new version or revert to what you had before.</p>
<hr>
<h2>How did I get started?</h2>
<p>I first read about the idea of using snapshot testing for SwiftUI in a blog post by <a href="https://www.vadimbulavin.com/snapshot-testing-swiftui-views/" rel="noreferrer nofollow noopener external" target="_blank">Vadim Bulavin</a>. He made a very good argument for this, but I found his instructions assumed more knowledge of the topic than I had at the time and so I discarded the idea after an initial attempt.</p>
<p>But he was suggesting using a <a href="https://github.com/pointfreeco/swift-snapshot-testing" rel="noreferrer nofollow noopener external" target="_blank">snapshotting library</a> published by <a href="https://www.pointfree.co" rel="noreferrer nofollow noopener external" target="_blank">Point-Free</a> and I later discovered a link to one of their videos where they discuss this exact thing: <a href="https://www.pointfree.co/episodes/ep86-swiftui-snapshot-testing" rel="noreferrer nofollow noopener external" target="_blank">SwiftUI Snapshot Testing</a>. This was enough to get me going with attempt #2.</p>
<hr>
<h2>Setting up an app for snapshot testing</h2>
<p>Since the blog post and video were talking about iOS apps, I decided to start there, but you know me, I will get to macOS apps later...</p>
<p>First off, I created a single view iOS app using SwiftUI making sure to check &quot;Include Unit Tests&quot;, but not &quot;Include UI Tests&quot;. I created a simple view so I had something to test.</p>
<p>If you want to use this on an app that does not already have a unit tests target, go to the project settings, click the + button to add a new target and choose a Unit Testing Bundle.</p>
<p>Next step was to import the snapshot testing library using Swift Package Manager. Go to File &gt; Swift Packages &gt; Add Package Dependency. Paste in the URL below and click Next.</p>
<pre class="language-text"><code class="language-text">https://github.com/pointfreeco/swift-snapshot-testing</code></pre>
<p>I accepted the default versioning suggestions on the next pane.</p>
<p><img src="/images/2020/Snapshot-AddPackage.png" alt="Adding the snapshot package"></p>
<p>On the final pane, it is important to select the correct target for this package. Select the app's test target, not the app itself and not the UI test target if you have one. I made this mistake on my first try as I assumed that snapshot testing would be part of UI testing but it is actually part of unit testing.</p>
<p><img src="/images/2020/Snapshot-SetTarget.png" alt="Setting the package target"></p>
<hr>
<h2>Writing a Snapshot Test</h2>
<p>Now I added a new Unit Test Case Class file to the tests target in my app. I had to import SwiftUI and SnapshotTesting into this test file as well as declaring the app as a testable import. The easiest way to do this is to copy the <code>@testable import</code> heading from the sample test file to make sure it is exactly right. The import needs to match the name of your app module.</p>
<p>Finally it's time to write the first snapshot test:</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">import</span> <span class="token class-name">XCTest</span>
<span class="token keyword">import</span> <span class="token class-name">SnapshotTesting</span>
<span class="token keyword">import</span> <span class="token class-name">SwiftUI</span>
<span class="token attribute atrule">@testable</span> <span class="token keyword">import</span> <span class="token class-name">Snapshots</span>

<span class="token keyword">class</span> <span class="token class-name">SnapshotsTests</span><span class="token punctuation">:</span> <span class="token class-name">XCTestCase</span> <span class="token punctuation">{</span>

    <span class="token keyword">func</span> <span class="token function-definition function">testDefaultAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> contentView <span class="token operator">=</span> <span class="token class-name">ContentView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">assertSnapshot</span><span class="token punctuation">(</span>matching<span class="token punctuation">:</span> contentView<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>image<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span></code></pre>
<p>This uses the snapshot library's <code>assertSnapshot</code> method to save the content view as an image. But unfortunately, this doesn't work. The problem is that the second parameter is a Snapshotting strategy that can convert various UI elements into some form of data or image. But the library doesn't know what a SwiftUI View is, so it needs a way to convert the view into something that can be recognized by the snapshotter.</p>
<p>I added this extension to SwiftUI's View that wraps the SwiftUI View in a UIHostingController. It returns this as a UIViewController which is a valid input for a snapshotter and can be converted to an image.</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">extension</span> <span class="token class-name">SwiftUI</span><span class="token punctuation">.</span><span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function-definition function">toVC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">UIViewController</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> vc <span class="token operator">=</span> <span class="token class-name">UIHostingController</span><span class="token punctuation">(</span>rootView<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">)</span>
        vc<span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame <span class="token operator">=</span> <span class="token class-name">UIScreen</span><span class="token punctuation">.</span>main<span class="token punctuation">.</span>bounds
        <span class="token keyword">return</span> vc
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Now my first test became:</p>
<pre class="language-swift"><code class="language-swift">    <span class="token keyword">func</span> <span class="token function-definition function">testDefaultAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> contentView <span class="token operator">=</span> <span class="token class-name">ContentView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">assertSnapshot</span><span class="token punctuation">(</span>matching<span class="token punctuation">:</span> contentView<span class="token punctuation">.</span><span class="token function">toVC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>image<span class="token punctuation">)</span>
    <span class="token punctuation">}</span></code></pre>
<p>And it worked. Or rather it failed as expected because there was no image to compare it with.</p>
<p><a href="/images/2020/Snapshot-Test1Result.png"><img src="/images/2020/Snapshot-Test1Result.png" alt="Test result"></a></p>
<p>Checking the error message, I was able to see where it had created the snapshot image file which I could look at. And the second time I ran the test, it passed.</p>
<p><img src="/images/2020/Snapshot-TestImage1.png" alt="Test image in Finder"></p>
<blockquote>
<p>If you ever get an error message saying &quot;No such module 'SnapshotTesting'&quot; use Shift-Command-U to re-build for testing. This usually only happens after you have cleaned your build folder.</p>
</blockquote>
<hr>
<h2>Testing a Change</h2>
<p>Now that I had a passing test, the next thing was to check what happens if the UI changes. This may be due to a deliberate change or because the cat just walked across your keyboard (a not infrequent occurrence around here).</p>
<p>Where I originally had a button with the label &quot;Save&quot;, I decided to change this to &quot;OK&quot; (rejecting the cat's suggestion of &quot;q2eegrnh&quot;).</p>
<p>Running the test again produced this result:</p>
<p><a href="/images/2020/Snapshot-FailedTest.png"><img src="/images/2020/Snapshot-FailedTest.png" alt="Failed snapshot test"></a></p>
<p>And I was then able to compare the 2 images, using the path to the failing image from the error message.</p>
<p><img src="/images/2020/Snapshot-TestResults.png" alt="Test results: success and failure"></p>
<p>Once I had confirmed that the new image was what I wanted and not a result of error, either feline or human, I set the test to <code>record</code> a new result so that the new version became the official test version.</p>
<pre class="language-swift"><code class="language-swift">    <span class="token keyword">func</span> <span class="token function-definition function">testDefaultAppearance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> contentView <span class="token operator">=</span> <span class="token class-name">ContentView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        record <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token function">assertSnapshot</span><span class="token punctuation">(</span>matching<span class="token punctuation">:</span> contentView<span class="token punctuation">.</span><span class="token function">toVC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>image<span class="token punctuation">)</span>
    <span class="token punctuation">}</span></code></pre>
<p>This caused a failing test again as the new version was written to the Snapshots folder, but after removing the <code>record = true</code> line and re-running the test, it passed again, with my new button label now an accepted part of the test.</p>
<hr>
<h2>Using Snapshots with State</h2>
<p>In SwiftUI, the UI displayed is a function of state, so changing state properties changes the UI. This is what makes snapshot testing really good for SwiftUI apps as you can change the state programmatically and confirm that this is reflected in the UI.</p>
<p>So having proved that the snapshot tests worked, I decided to move on and test it with my new <a href="/post/2020/name_this_app/">anagram assistant app</a>. This is quite a simple app that has a single <code>AppState</code> class that holds all the program data.</p>
<p>So I was able to write a suite of tests that changed the state in various ways and then snap-shotted the UI with that state. Here are a couple of examples:</p>
<pre class="language-swift"><code class="language-swift">    <span class="token keyword">func</span> <span class="token function-definition function">testEmptyContentView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> contentView <span class="token operator">=</span> <span class="token class-name">ContentView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">assertSnapshot</span><span class="token punctuation">(</span>matching<span class="token punctuation">:</span> contentView<span class="token punctuation">.</span><span class="token function">toVC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>image<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">func</span> <span class="token function-definition function">testAfterLocking</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> contentView <span class="token operator">=</span> <span class="token class-name">ContentView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">let</span> appState <span class="token operator">=</span> <span class="token class-name">AppState</span><span class="token punctuation">.</span><span class="token function">sampleState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        appState<span class="token punctuation">.</span>availableLetters<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        appState<span class="token punctuation">.</span>selectedLetterIndex <span class="token operator">=</span> <span class="token number">1</span>
        appState<span class="token punctuation">.</span><span class="token function">placeSelectedLetter</span><span class="token punctuation">(</span>at<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span>
        appState<span class="token punctuation">.</span><span class="token function">toggleLockedState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        appState<span class="token punctuation">.</span>availableLetters<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        contentView<span class="token punctuation">.</span>appState <span class="token operator">=</span> appState
        <span class="token function">assertSnapshot</span><span class="token punctuation">(</span>matching<span class="token punctuation">:</span> contentView<span class="token punctuation">.</span><span class="token function">toVC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>image<span class="token punctuation">)</span>
    <span class="token punctuation">}</span></code></pre>
<p>This worked really well with only one slight problem. As the state arranges the <code>availableLetters</code> array randomly for display, I had to add a <code>sort</code> to make sure they always displayed in the same order and made the tests repeatable.</p>
<p>And as a bonus, I was able to test a screen in dark mode with this test which sets the <code>colorScheme</code>:</p>
<pre class="language-swift"><code class="language-swift">    <span class="token keyword">func</span> <span class="token function-definition function">testDarkMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> contentView <span class="token operator">=</span> <span class="token class-name">ContentView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        contentView<span class="token punctuation">.</span>appState <span class="token operator">=</span> <span class="token function">sampleAppState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token function">assertSnapshot</span><span class="token punctuation">(</span>
            matching<span class="token punctuation">:</span> contentView<span class="token punctuation">.</span><span class="token function">colorScheme</span><span class="token punctuation">(</span><span class="token punctuation">.</span>dark<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toVC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>image<span class="token punctuation">)</span>
    <span class="token punctuation">}</span></code></pre>
<hr>
<h2>Accessibility Tests</h2>
<p>iOS supports dynamic type and if your app uses standard font styles, it will adopt these dynamic sizes automatically. I can't find the link right now, but I remember reading an article that said nearly half of all iPhone users change the default text size, setting it either smaller or larger.</p>
<p>With snapshot testing, it is quick and easy to get a view of how you app looks with different font sizes. Here is my test function for taking a snapshot of every possible font size variation.</p>
<pre class="language-swift"><code class="language-swift">    <span class="token keyword">func</span> <span class="token function-definition function">testDynamicFonts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> contentView <span class="token operator">=</span> <span class="token class-name">ContentView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        contentView<span class="token punctuation">.</span>appState <span class="token operator">=</span> <span class="token function">sampleAppState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> contentSize <span class="token keyword">in</span> <span class="token class-name">ContentSizeCategory</span><span class="token punctuation">.</span>allCases <span class="token punctuation">{</span>
            <span class="token function">assertSnapshot</span><span class="token punctuation">(</span>matching<span class="token punctuation">:</span> contentView<span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">(</span><span class="token punctuation">\</span><span class="token punctuation">.</span>sizeCategory<span class="token punctuation">,</span> contentSize<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toVC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                           <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>image<span class="token punctuation">,</span>
                           named<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"</span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation">contentSize</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code></pre>
<p>For the settings screen, I decided that smaller fonts were not a problem, but I wanted to check the two largest options, so I used this test function:</p>
<pre class="language-swift"><code class="language-swift">    <span class="token keyword">func</span> <span class="token function-definition function">testSettingsScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> settingsView <span class="token operator">=</span> <span class="token class-name">SettingsView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">assertSnapshot</span><span class="token punctuation">(</span>matching<span class="token punctuation">:</span> settingsView<span class="token punctuation">.</span><span class="token function">toVC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>image<span class="token punctuation">)</span>

        <span class="token function">assertSnapshot</span><span class="token punctuation">(</span>
            matching<span class="token punctuation">:</span> settingsView<span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">(</span>
                <span class="token punctuation">\</span><span class="token punctuation">.</span>sizeCategory<span class="token punctuation">,</span> <span class="token class-name">ContentSizeCategory</span><span class="token punctuation">.</span>accessibilityExtraExtraExtraLarge
            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toVC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>image<span class="token punctuation">,</span>
            named<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"AccessibilityXXXL"</span></span><span class="token punctuation">)</span>

        <span class="token function">assertSnapshot</span><span class="token punctuation">(</span>
            matching<span class="token punctuation">:</span> settingsView<span class="token punctuation">.</span><span class="token function">environment</span><span class="token punctuation">(</span>
                <span class="token punctuation">\</span><span class="token punctuation">.</span>sizeCategory<span class="token punctuation">,</span> <span class="token class-name">ContentSizeCategory</span><span class="token punctuation">.</span>extraExtraExtraLarge
            <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toVC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">as</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>image<span class="token punctuation">,</span>
            named<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"XXXL"</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span></code></pre>
<p><img src="/images/2020/Snapshot-DynamicFonts.png" alt="Dynamic font tests"></p>
<p>This let me quickly see where the problems were and what I needed to adjust.</p>
<hr>
<h2>Snapshot Test for Mac Apps</h2>
<p>You knew you weren't going to get through this without me going on about Mac apps...</p>
<p>Snapshot tests for a Mac app work well, with one caveat.</p>
<p>First I had to change the Swift.View extension so that it returned an NSViewController instead of a UIViewController.</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">extension</span> <span class="token class-name">SwiftUI</span><span class="token punctuation">.</span><span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token keyword">func</span> <span class="token function-definition function">toVC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">NSViewController</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> vc <span class="token operator">=</span> <span class="token class-name">NSHostingController</span><span class="token punctuation">(</span>rootView<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">)</span>
        vc<span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame <span class="token operator">=</span> <span class="token class-name">CGRect</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> <span class="token number">1024</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">768</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> vc
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>I chose an arbitrary size for the snapshot, you just need to make sure your UI will fit into whatever size you select.</p>
<p>The real problem was with sand-boxing. The snapshot library was blocked from writing the image files to the project directory if the app was sand-boxed. This seems really peculiar, since Xcode is running the tests and Xcode writes to the project directory all the time!</p>
<p>I found two ways around this:</p>
<ol>
<li>Turn off sand-box mode temporarily while testing.</li>
<li>Make a non-sand-boxed target and use it for testing against.</li>
</ol>
<p>Neither of these are particularly great. Option 1 is tedious, although I think it can work if the snapshots remain the same, it only fails if there is a change that it needs to write to disk.</p>
<p>Option 2 is tedious to set up (<a href="/contact/">contact me</a> if you would like more details) but is more seamless after that.</p>
<p>The best solution would be for Xcode to allow you to turn off sand-boxing for a test target. Maybe Xcode 12...</p>
<hr>
<h2>Limitations of Snapshot Testing</h2>
<p>Ignoring the Mac and concentrating only on iOS apps for the moment, there were a few issues:</p>
<ol>
<li>
<p>You have to run your tests against the same simulator every time, or at least against a simulator with the same screen dimensions. I decided to to use the iPhone SE (2nd generation) as it has a small screen and I find smaller screens to be more of a problem than large ones. You also need to make sure it is always using the same appearance: light or dark, unless you want to specify this for every test.</p>
<p>I ended up with this setup function that ran before my snapshot test suite:</p>
</li>
</ol>
<pre class="language-swift"><code class="language-swift">    <span class="token keyword">static</span> <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function-definition function">setUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> device <span class="token operator">=</span> <span class="token class-name">UIDevice</span><span class="token punctuation">.</span>current<span class="token punctuation">.</span>name
        <span class="token keyword">if</span> device <span class="token operator">!=</span> <span class="token string-literal"><span class="token string">"iPhone SE (2nd generation)"</span></span> <span class="token punctuation">{</span>
            <span class="token function">fatalError</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Switch to using iPhone SE (2nd generation) for these tests."</span></span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">UIView</span><span class="token punctuation">.</span><span class="token function">setAnimationsEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token class-name">UIApplication</span><span class="token punctuation">.</span>shared<span class="token punctuation">.</span>windows<span class="token punctuation">.</span>first<span class="token operator">?</span><span class="token punctuation">.</span>layer<span class="token punctuation">.</span>speed <span class="token operator">=</span> <span class="token number">100</span>

        record <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span></code></pre>
<p>This uses a couple of tricks that are supposed to speed up tests and has a <code>record</code> setting that I could set for the entire suite if I wished, and it throws a <code>fatalError</code> if I select the wrong device or simulator.</p>
<p>It would be neater if Xcode allowed you to select a simulator in the test target build settings, but I think you can only do this if you run tests from the command line.</p>
<ol start="2">
<li>
<p>Snapshot tests confirm that the UI matches the state, but they do not check to see if the state changes in response to user input. That is the missing link that UI testing provides, but even without that, I believe that snapshot testing is a very useful tool and much better than having no form of UI testing at all.</p>
</li>
<li>
<p>You need to look at your snapshots. This may sound obvious but the snapshot library creates a set of images. These images are then set as the goal for future tests. If you don't check that they are correct, then every test could be confirming that the UI is wrong but unchanged. If the tests report a difference, look at both copies and see which one is right. For the same reason, the snapshot images need to be included in your version control repository.</p>
</li>
</ol>
<hr>
<h2>Summary</h2>
<p>Will I use snapshot tests for my SwiftUI apps? Yes, definitely. I use unit tests for my model classes but mostly avoid UI tests as they are too clumsy to write and time-consuming to run. Snapshot tests are better for SwiftUI, and very fast.</p>
<p>Huge thanks to <a href="https://twitter.com/V8tr" rel="noreferrer nofollow noopener external" target="_blank">Vadim Bualvin</a> for the original inspiration for this article. Go and read his <a href="https://www.vadimbulavin.com/snapshot-testing-swiftui-views/" rel="noreferrer nofollow noopener external" target="_blank">blog post</a> for a more detailed look. And thanks to <a href="https://www.twitter.com/mbrandonw" rel="noreferrer nofollow noopener external" target="_blank">Brandon Williams</a> &amp; <a href="https://www.twitter.com/stephencelis" rel="noreferrer nofollow noopener external" target="_blank">Stephen Celis</a> at <a href="https://www.pointfree.co" rel="noreferrer nofollow noopener external" target="_blank">Point-Free</a> for getting me going after my initial discarding of the idea. Any mistakes or errors are mine and not theirs.</p>
<p>If you want to learn about UI testing for SwiftUI apps, I recommend watching <a href="https://twitter.com/azamsharp" rel="noreferrer nofollow noopener external" target="_blank">azamsharp's</a> YouTube video: <a href="https://www.youtube.com/watch?v=dFQtFJsvt04" rel="noreferrer nofollow noopener external" target="_blank">User Interface Testing for SwiftUI Applications</a>.</p>
<p>As always, if you have any comments, suggestions or ideas, I would love to hear from you. Please contact me using one of the links below or through my <a href="/contact/">Contact</a> page.</p>

        </article>
    </section>

    </main>
    <footer>
        <div class="footer-content">
  <nav>
    <ul class="footer-links">
      
        <li>
          <a href="mailto:info@troz.net">
            <img src="/images/links/envelope.svg" alt="Email" title="Email" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://mastodon.social/@troz" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/mastodon.png" alt="Mastodon" title="Mastodon" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://linktr.ee/trozware" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/tree.svg" alt="Linktree" title="Linktree" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://github.com/trozware" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/github.svg" alt="GitHub" title="GitHub" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://stackoverflow.com/users/1082632" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/stack-overflow.svg" alt="Stack Overflow" title="Stack Overflow" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://dev.to/trozware" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/dev-badge.svg" alt="Dev To" title="Dev To" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="/index.xml">
            <img src="/images/links/rss.svg" alt="RSS Feed" title="RSS Feed" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="/atom.xml">
            <img src="/images/links/atom.svg" alt="Atom Feed" title="Atom Feed" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="/feed.json">
            <img src="/images/links/json.png" alt="JSON Feed" title="JSON Feed" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://ko-fi.com/trozware" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/kofi1.png.webp" alt="Buy Me a Coffee" title="Buy Me a Coffee" height="30px" >
          </a>
        </li>
      
    </ul>
  </nav>
</div>

        <div class="copyright">
            <p>Copyright &copy; 2025 Sarah Reichelt, TrozWare</p>
        </div>
    </footer>

    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            let searchElement = document.getElementById('search');
            if (searchElement) {
                new PagefindUI({ element: searchElement, showSubResults: true });
            }
        });
    </script>
    <script src="/js/theme_switcher.js"></script>
    <script src="/js/clipboard.js"></script>
    <script src="/js/menu.js"></script>
</body>
</html>
