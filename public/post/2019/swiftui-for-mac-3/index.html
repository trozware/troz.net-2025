<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwiftUI for Mac - Part 3</title>
    
    <link href="/styles/style.css" rel="stylesheet" >


    <link href="/styles/prism.css" rel="stylesheet" >



<link href="/pagefind/pagefind-ui.css" rel="stylesheet">
<script src="/pagefind/pagefind-ui.js"></script>
<style>
@media (prefers-color-scheme: dark) {
    :root {
    --pagefind-ui-primary: #eeeeee;
    --pagefind-ui-text: #eeeeee;
    --pagefind-ui-background: #152028;
    --pagefind-ui-border: #152028;
    --pagefind-ui-tag: #152028;
    }
}
</style>
    











  


<meta property="og:site_name" content="TrozWare" >
<meta property="og:title" content="SwiftUI for Mac - Part 3 - TrozWare" >
<meta property="og:type" content="website" >
<meta property="og:url" content="https://troz.net/post/2019/swiftui-for-mac-3/" >
<meta name="keywords" content="Mac app development, Apple Mac, Xcode, Swift, SwiftUI, Apple macOS, books, articles, blog, apps, developer, author, Sarah Reichelt">




  <meta name="description" content="Crazy Mac lady. Mac author &amp; developer. Lover of Apple computers and devices. Swift &amp; SwiftUI enthusiast. Unofficial Mac app dev evangelist" >
  <meta property="og:description" content="Crazy Mac lady. Mac author &amp; developer. Lover of Apple computers and devices. Swift &amp; SwiftUI enthusiast. Unofficial Mac app dev evangelist" >



<link rel="alternate" type="application/rss+xml" href="/index.xml" title="TrozWare">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="TrozWare">
<link rel="alternate" type="application/json" href="/feed.json" title="TrozWare">


<link rel="icon" type="image/png" href="/images/favicon.png">

    <link rel="icon" href="/favicon.ico" sizes="32x32">
<link rel="icon" href="/icon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
</head>

<body>
    <header>
  <nav class="container">
    <div class="nav-brand">
      <a href="/" class="site-title">TrozWare</a>
      <button class="menu-toggle" aria-label="Toggle menu" aria-expanded="false">
        <span class="hamburger"></span>
      </button>
    </div>

    <ul class="nav-links">
      
        <li>
          <a href="/" class="nav-link">Home</a>
        </li>
      
        <li>
          <a href="/books/" class="nav-link">Books</a>
        </li>
      
        <li>
          <a href="/apps/" class="nav-link">Apps</a>
        </li>
      
        <li>
          <a href="/archives/" class="nav-link">Archives</a>
        </li>
      
        <li>
          <a href="/tags/" class="nav-link">Tags</a>
        </li>
      
        <li>
          <a href="/contact/" class="nav-link">Contact</a>
        </li>
      

      <li>
        <button           class="theme-toggle"
          type="button"
          title="Toggle theme"
          aria-label="Toggle theme"
          onclick="toggleTheme()"
        >
          <svg             xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
            width="1em"
            height="1em"
            class="theme-toggle__dark-side"
            fill="currentColor"
            viewBox="0 0 32 32"
          >
            <path d="M16 .5C7.4.5.5 7.4.5 16S7.4 31.5 16 31.5 31.5 24.6 31.5 16 24.6.5 16 .5zm0 28.1V3.4C23 3.4 28.6 9 28.6 16S23 28.6 16 28.6z" ></path>
          </svg>
        </button>
      </li>
    </ul>
  </nav>
</header>

    
	<main>
        
    <section class="post">
        <h1 data-pagefind-meta="title">SwiftUI for Mac - Part 3</h1>

        <p>
            15th December 2019 • 1,573 words • 9 minutes  reading time.
        </p>

        <div class="tag-list">
            
                <a href="/tags/#swift" class="tag-button">#Swift</a>
            
                <a href="/tags/#swiftui" class="tag-button">#SwiftUI</a>
            
                <a href="/tags/#macos" class="tag-button">#macOS</a>
            
        </div>

        <article data-pagefind-body>
            <p>In <a href="/post/2019/swiftui-for-mac-1/">part 1 of this series</a>, I created a Mac app using SwiftUI. The app uses a Master-Detail design to list entries in an outline on the left and show details about the selected entry in the detail view on the right. In <a href="/post/2019/swiftui-for-mac-2/">part 2</a> I explored using menus, adding all the expected user interface elements and opening secondary windows.</p>
<p>In this third and final part, I want to look at the various ways to present dialogs to the user.</p>

<p>There are four different types of dialog that I want to explore:</p>
<ul>
<li>Alert</li>
<li>Action</li>
<li>Sheet</li>
<li>File dialogs (open &amp; save)</li>
</ul>
<p>So the first thing to do is add a footer to the DetailView to trigger each of these. I am going to separate this out into a new subview for neatness.</p>
<h2>Alert</h2>
<p>To make an Alert, I need an @State Bool which sets whether the alert is visible or not. All the button has to do is toggle that Bool. Stripping out the extra code and views, this is what I have.</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">DialogsView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> alertIsShowing <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token attribute atrule">@State</span> <span class="token keyword">private</span> <span class="token keyword">var</span> dialogResult <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Click the buttons above to test the dialogs."</span></span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
        <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Alert"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">self</span><span class="token punctuation">.</span>alertIsShowing<span class="token punctuation">.</span><span class="token function">toggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>To configure the alert itself, I added an alert modifier to the outmost view in this view. The <code>dialogResult</code> string is a diagnostic that I can use to confirm that the results of the various dialogs get passed back to the parent view.</p>
<pre class="language-swift"><code class="language-swift">  <span class="token class-name">Alert</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Alert"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        message<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"This is an alert!"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        dismissButton<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"OK"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">self</span><span class="token punctuation">.</span>dialogResult <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"OK clicked in Alert"</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>There were a few things that tripped me up in this relatively short chunk of code. Firstly, both title and message must be Text views, not strings. If you get an error message that says &quot;Cannot convert value of type 'String' to expected argument type 'Text'&quot;, then you have forgotten to use a Text view.</p>
<p>Then there is the button which auto-suggest tells me is of type Alert.Button. I couldn't find any documentation for this, but delving into the definition for Alert, I see that there are three pre-defined button types: default, cancel or destructive. Cancel actually has two variants and will use a label appropriate to the user's locale if no label is supplied.</p>
<p>Again, these buttons need a Text view as the label (if supplied) and can take an action closure, which I used to update my <code>dialogResult</code> string.</p>
<p>This version showed a single <code>dismissButton</code> but I saw that there was a variation of Alert with <code>primary</code> and <code>secondary</code> buttons. It was not obvious that these would also dismiss the alert dialog, but I tried anyway.</p>
<pre class="language-swift"><code class="language-swift">  <span class="token class-name">Alert</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Alert"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        message<span class="token punctuation">:</span> <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"This is an alert!"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        primaryButton<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"OK"</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token keyword">self</span><span class="token punctuation">.</span>dialogResult <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"OK clicked in Alert"</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> secondaryButton<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token keyword">self</span><span class="token punctuation">.</span>dialogResult <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Cancel clicked in Alert"</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>
<p>This worked very nicely and the Esc and Return keys triggered the two buttons as you would expect with both of them closing the dialog.</p>
<p><img src="/images/2019/SwiftUI-Mac-alert.jpg" alt="Alert"></p>
<p>I tried using the <code>destructive</code> button type, but there was no difference to either the appearance or behavior of the button.</p>
<p>So Alert is a great choice for a text-based dialog, either for informational use or to allow two choices of action.</p>
<h2>Action</h2>
<p>Very short section here - 'ActionSheet' is unavailable in macOS! I probably should have researched that before I started this section. So use Alerts, I guess or a custom sheet.</p>
<h2>Sheets</h2>
<p>While Alerts have a very fixed structure, sheets allow us to put any SwiftUI view into a sheet dialog.</p>
<p>So I added another Bool for the Sheet button to toggle, and added this sheet modifier. SheetView right now is simply a TextView.</p>
<pre class="language-swift"><code class="language-swift">  <span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span>isPresented<span class="token punctuation">:</span> $sheetIsShowing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">SheetView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span></code></pre>
<p>This didn't work so well. It showed the sheet, but the sheet was tiny - only the size of the Text view it contained. And I had no way of dismissing it...</p>
<p>The size problem was solved by setting a frame on the Text view in SheetView.</p>
<p>The trick to dismissing the sheet is to pass it a Binding to the Bool that triggered it to open in the first place. If a button in the sheet sets this Bool back to false, the parent view will hide the sheet. That sounds confusing, but it works.</p>
<pre class="language-swift"><code class="language-swift">  <span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span>isPresented<span class="token punctuation">:</span> $sheetIsShowing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">SheetView</span><span class="token punctuation">(</span>isVisible<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>$sheetIsShowing<span class="token punctuation">)</span>
  <span class="token punctuation">}</span></code></pre>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">SheetView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token attribute atrule">@Binding</span> <span class="token keyword">var</span> isVisible<span class="token punctuation">:</span> <span class="token class-name">Bool</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
        <span class="token class-name">VStack</span> <span class="token punctuation">{</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"This is a sheet."</span></span><span class="token punctuation">)</span>
            <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"OK"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>isVisible <span class="token operator">=</span> <span class="token boolean">false</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Here is a very bad diagram that tries to explain what is happening:</p>
<p><img src="/images/2019/SwiftUI-Mac-sheet.png" alt="Sheet"></p>
<p>The parent view has an @State Boolean variable called <code>sheetIsShowing</code>. This is bound to the alert's <code>isPresented</code> so it dictates whenever the sheet is visible. When the Sheet button is clicked, this variable is set to <code>true</code> and the sheet opens. But at the same time, a Binding to this variable is passed to the sheet. I deliberately gave this a different name, so as to make it clear which View was changing what variable.</p>
<p>When the sheet wants to close, it does not close itself. Instead it sets this variable to false. Because it is a Binding, this sets the original <code>sheetIsShowing</code> variable on the parent view to false and the parent view then closes the sheet.</p>
<p><strong>UPDATE:</strong> Look at <strong><a href="/post/2020/swiftui_for-mac-extras#dismissing-sheets">Dismissing sheets</a></strong> in my post of extras &amp; changes to this series for an alternative way to dismiss a sheet.</p>
<h3>Sheets &amp; Data</h3>
<p>With this in place, I had the sheet opening and closing perfectly, but I was not yet passing data back &amp; forth between the sheet and its parent view. I decide to put a TextField in the SheetView and bind its contents to the <code>dialogResult</code> property in the DetailView so that any edits appeared immediately in the DetailView. And while I am there, I might as well add some more decorations to the SheetView since it is a full View and not a restricted Alert.</p>
<p>Calling the SheetView changed to this:</p>
<pre class="language-swift"><code class="language-swift">  <span class="token punctuation">.</span><span class="token function">sheet</span><span class="token punctuation">(</span>isPresented<span class="token punctuation">:</span> $sheetIsShowing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">SheetView</span><span class="token punctuation">(</span>isVisible<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>$sheetIsShowing<span class="token punctuation">,</span> enteredText<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span>$dialogResult<span class="token punctuation">)</span>
  <span class="token punctuation">}</span></code></pre>
<p>And the SheetView itself (not all the interface is listed here for brevity):</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">SheetView</span><span class="token punctuation">:</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
    <span class="token attribute atrule">@Binding</span> <span class="token keyword">var</span> isVisible<span class="token punctuation">:</span> <span class="token class-name">Bool</span>
    <span class="token attribute atrule">@Binding</span> <span class="token keyword">var</span> enteredText<span class="token punctuation">:</span> <span class="token class-name">String</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
        <span class="token class-name">VStack</span> <span class="token punctuation">{</span>
            <span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Enter some text below…"</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">font</span><span class="token punctuation">(</span><span class="token punctuation">.</span>headline<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">multilineTextAlignment</span><span class="token punctuation">(</span><span class="token punctuation">.</span>center<span class="token punctuation">)</span>

            <span class="token class-name">TextField</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Enter the result of the dialog here…"</span></span><span class="token punctuation">,</span> text<span class="token punctuation">:</span> $enteredText<span class="token punctuation">)</span>
                 <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token class-name">HStack</span> <span class="token punctuation">{</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"Cancel"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">self</span><span class="token punctuation">.</span>isVisible <span class="token operator">=</span> <span class="token boolean">false</span>
                    <span class="token keyword">self</span><span class="token punctuation">.</span>enteredText <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Cancel clicked in Sheet"</span></span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Spacer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token class-name">Button</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"OK"</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">self</span><span class="token punctuation">.</span>isVisible <span class="token operator">=</span> <span class="token boolean">false</span>
                    <span class="token keyword">self</span><span class="token punctuation">.</span>enteredText <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"OK: </span><span class="token interpolation-punctuation punctuation">\(</span><span class="token interpolation"><span class="token keyword">self</span><span class="token punctuation">.</span>enteredText</span><span class="token interpolation-punctuation punctuation">)</span><span class="token string">"</span></span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">frame</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">300</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">padding</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><img src="/images/2019/SwiftUI-Mac-sheet-data.png" alt="Sheet with data"></p>
<p>I only had two issues with this now. I was not able to get the focus into the TextField automatically when the sheet opened and I was not able to assign keyboard shortcuts to the Cancel and OK buttons so that they could be operated without a mouse. And as I mentioned in the previous part, I was not able to make the OK button take on the default styling.</p>
<p>One useful technique that I developed: the SheetView is in the DialogsView.swift file instead of in its own SwiftUI file. It would probably be a good idea to separate it out but I didn't which meant that it had no Canvas preview to look at while I was laying it out.</p>
<p>So I edited the PreviewProvider like this, so that I could change the comments to switch it between showing the DialogsView and showing the SheetView.</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">DialogsView_Previews</span><span class="token punctuation">:</span> <span class="token class-name">PreviewProvider</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">var</span> previews<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
        <span class="token comment">// DialogsView()</span>
        <span class="token class-name">SheetView</span><span class="token punctuation">(</span>isVisible<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> enteredText<span class="token punctuation">:</span> <span class="token punctuation">.</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">""</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h2>Files</h2>
<p>AppKit provides NSOpenPanel for selecting a file and NSSavePanel for saving. I will try to implement NSSavePanel to allow saving the current cat image.</p>
<p>Since this is an AppKit control rather than a SwiftUI control, I assumed that I would need to use NSViewRepresentable like I did for the NSColorWell in part 2. But while NSColorWell is a descendent of NSView, NSSavePanel is not. So I need a new idea.</p>
<p>Rather naively, I thought maybe I could just create an NSSavePanel in a function inside DialogsView and see what happened.</p>
<pre class="language-swift"><code class="language-swift">  <span class="token keyword">func</span> <span class="token function-definition function">saveImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> panel <span class="token operator">=</span> <span class="token class-name">NSSavePanel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      panel<span class="token punctuation">.</span>nameFieldLabel <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"Save cat image as:"</span></span>
      panel<span class="token punctuation">.</span>nameFieldStringValue <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"cat.jpg"</span></span>
      panel<span class="token punctuation">.</span>canCreateDirectories <span class="token operator">=</span> <span class="token boolean">true</span>
      panel<span class="token punctuation">.</span>begin <span class="token punctuation">{</span> response <span class="token keyword">in</span>
          <span class="token keyword">if</span> response <span class="token operator">==</span> <span class="token class-name">NSApplication</span><span class="token punctuation">.</span><span class="token class-name">ModalResponse</span><span class="token punctuation">.</span><span class="token constant">OK</span><span class="token punctuation">,</span> <span class="token keyword">let</span> fileUrl <span class="token operator">=</span> panel<span class="token punctuation">.</span>url <span class="token punctuation">{</span>
              <span class="token function">print</span><span class="token punctuation">(</span>fileUrl<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span></code></pre>
<p>Crash &amp; burn... so what if I made the NSSavePanel an @State property of the View? No, that crashed even faster. Maybe SwiftUI Views don't like this sort of thing, but how about if I get the Application Delegate to handle it? What if I moved the <code>saveImage</code> method to the App Delegate and changed the calling function to access it there?</p>
<p>Still crashed. At this stage I am beginning to wonder if I know how to use an NSSavePanel. Time to create a simple test app without SwiftUI and see what happens. Well it appears that I no longer know how to use an NSSavePanel. Code from an older project that works fine, will not work in my new sample project!</p>
<p>Guess what - it was another macOS Catalina security issue which I would have realised faster I had opened the Console. Back to the Signing &amp; Capabilities section of the target settings and this time I set File Access for User Selected File to Read/Write.</p>
<p>Now the NSSavePanel opens when called from DialogsView and prints the selected file URL if one is chosen.</p>
<p>But this is all happening in DialogsView, which is a subview of DetailView. And DetailView is the view that holds the image, not DialogsView. So how can I save the image? Do I pass the URL to DetailView or pass the image to DialogsView? Or do something clever with Notifications and Subscriptions?</p>
<p>I really don't know what is best, but I have decided to post a Notification with the URL as its object. DetailView can receive this Notification and save the image whenever it is received.</p>
<p>So I replaced the <code>print</code> line in the <code>saveImage()</code> method with:</p>
<pre class="language-swift"><code class="language-swift">  <span class="token class-name">NotificationCenter</span><span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token punctuation">.</span>saveImage<span class="token punctuation">,</span> object<span class="token punctuation">:</span> fileUrl<span class="token punctuation">)</span></code></pre>
<p>And in DetailView, I set up the publisher:</p>
<pre class="language-swift"><code class="language-swift">    <span class="token keyword">private</span> <span class="token keyword">let</span> saveImageUrlSelected <span class="token operator">=</span> <span class="token class-name">NotificationCenter</span><span class="token punctuation">.</span><span class="token keyword">default</span>
         <span class="token punctuation">.</span><span class="token function">publisher</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">.</span>saveImage<span class="token punctuation">)</span>

    <span class="token keyword">var</span> body<span class="token punctuation">:</span> <span class="token keyword">some</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
        <span class="token class-name">VStack</span> <span class="token punctuation">{</span>
          <span class="token comment">// view code removed for brevity</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token function">onReceive</span><span class="token punctuation">(</span>saveImageUrlSelected<span class="token punctuation">)</span> <span class="token punctuation">{</span> publisher <span class="token keyword">in</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> saveUrl <span class="token operator">=</span> publisher<span class="token punctuation">.</span>object <span class="token keyword">as</span><span class="token operator">?</span> <span class="token constant">URL</span><span class="token punctuation">,</span>
                <span class="token keyword">let</span> imageData <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>catImage<span class="token operator">?</span><span class="token punctuation">.</span>tiffRepresentation <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token keyword">let</span> imageRep <span class="token operator">=</span> <span class="token class-name">NSBitmapImageRep</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> imageData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token keyword">let</span> saveData <span class="token operator">=</span> imageRep<span class="token punctuation">.</span><span class="token function">representation</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span> <span class="token punctuation">.</span>jpeg<span class="token punctuation">,</span>
                                                              properties<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">try</span><span class="token operator">?</span> saveData<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>to<span class="token punctuation">:</span> saveUrl<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code></pre>
<p>And there we have it. Three types of dialogs demonstrated in a SwiftUI for Mac app:</p>
<ol>
<li>Alerts: good for simply text-only dialogs</li>
<li>Sheets: good for more complex dialogs</li>
<li>Panels: AppKit dialogs that can be called from a SwiftUI View.</li>
</ol>
<p>I think this time I really am finished. This article has already expanded out into a 3-part monster, so I think it is way past time that I stopped typing. I hope you have enjoyed this series. Please use any of the buttons below to contact me or use the <a href="/contact/">Contact page</a> on this site. I would love to hear from anyone who found this series useful or who had any suggestions or corrections to make.</p>
<p>The final project is available on <a href="https://github.com/trozware/swiftui-mac" rel="noreferrer nofollow noopener external" target="_blank">GitHub</a> if you would like to download it and take a look.</p>

        </article>
    </section>

    </main>
    <footer>
        <div class="footer-content">
  <nav>
    <ul class="footer-links">
      
        <li>
          <a href="mailto:info@troz.net">
            <img src="/images/links/envelope.svg" alt="Email" title="Email" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://mastodon.social/@troz" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/mastodon.png" alt="Mastodon" title="Mastodon" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://linktr.ee/trozware" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/tree.svg" alt="Linktree" title="Linktree" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://github.com/trozware" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/github.svg" alt="GitHub" title="GitHub" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://stackoverflow.com/users/1082632" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/stack-overflow.svg" alt="Stack Overflow" title="Stack Overflow" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://dev.to/trozware" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/dev-badge.svg" alt="Dev To" title="Dev To" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="/index.xml">
            <img src="/images/links/rss.svg" alt="RSS Feed" title="RSS Feed" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="/atom.xml">
            <img src="/images/links/atom.svg" alt="Atom Feed" title="Atom Feed" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="/feed.json">
            <img src="/images/links/json.png" alt="JSON Feed" title="JSON Feed" height="30px" >
          </a>
        </li>
      
        <li>
          <a href="https://ko-fi.com/trozware" rel="noreferrer nofollow noopener external" target="_blank">
            <img src="/images/links/kofi1.png.webp" alt="Buy Me a Coffee" title="Buy Me a Coffee" height="30px" >
          </a>
        </li>
      
    </ul>
  </nav>
</div>

        <div class="copyright">
            <p>Copyright &copy; 2025 Sarah Reichelt, TrozWare</p>
        </div>
    </footer>

    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            let searchElement = document.getElementById('search');
            if (searchElement) {
                new PagefindUI({ element: searchElement, showSubResults: true });
            }
        });
    </script>
    <script src="/js/theme_switcher.js"></script>
    <script src="/js/clipboard.js"></script>
    <script src="/js/menu.js"></script>
</body>
</html>
